{% extends "base_map.html" %}
{% load i18n %}

{% block stylesheet %}
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/questionnaire.css" />
{% endblock %}


{% block content %}

<ul class="feature_comments">
</ul>
    
<p>
Samanväriset pallukat ovat samaan kysymykseen liittyviä paikannuksia. Viemällä hiiren pallukan
päälle voit tarkastella vastausta yksityiskohtaisemmin.
</p>
{% endblock content %}

{% block javascript %}
<script type="text/javascript" src="{{ STATIC_URL }}js/libs/proj4js-gnt.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/libs/OpenLayers-gnt.js"></script>
<script type="text/javascript" src="{% url api_javascript %}"></script>
<script type="text/javascript" src="{% url map_js map_slug_name=map_slug %}"></script>
<script src="{{ STATIC_URL }}js/feedback.js"></script>
<script type="text/javascript">
var data_group = 'Q-{{ questionnaire.slug }}';
var questionnaire_area = {{ questionnaire.area.json|safe }};
// add crs to area
questionnaire_area['crs'] = {"type": "name", 
                             "properties": {
                                 "code": "EPSG:{{ questionnaire.area.srid|safe }}"}};
// instead of using global varibles start using this object

var questionnaire = {
    'data_group': 'Q-{{ questionnaire.slug }}',
    'questionnaire_area': {{ questionnaire.area.json|safe }},
    'show_area': {{ questionnaire.show_area|lower }},
    'scale_visible_area': {{ questionnaire.scale_visible_area }}
}
// add crs to area
questionnaire.questionnaire_area['crs'] = {"type": "name", 
                                           "properties": {
                                                "code": "EPSG:{{ questionnaire.area.srid|safe }}"}};

function count_results() {
    var number_of_properties = 0;
    for(var val in gnt.questionnaire.npvalues) {
        number_of_properties++;
    }
    var number_of_places = map.getLayersByName('Point Layer')[0].features.length;
    var number_of_routes = map.getLayersByName('Route Layer')[0].features.length;
    var number_of_areas = map.getLayersByName('Area Layer')[0].features.length;
    var number_of_features = number_of_places + number_of_routes + number_of_areas;
    
    if( number_of_features === 0 ) {
        $('span.number_of_features').html("");
    } else if( number_of_features === 1) {
        $('span.number_of_features').html('{% trans "You marked one place" %}');
    } else {
        $('span.number_of_features').html('{% trans "You marked" %} ' + number_of_features + ' {% trans "places" %}');
    }
    if( number_of_properties === 0 ) {
        $('span.number_of_properties').html("");
    } else if( number_of_features !== 0) {
        if( number_of_properties === 1) {
            $('span.number_of_properties').html('{% trans "and answered one question" %}');
        } else {
            $('span.number_of_properties').html('{% trans "and answered" %} ' + number_of_properties + ' {% trans "questions" %}');
        }
    } else if ( number_of_properties === 1) {
        $('span.number_of_properties').html('{% trans "You answered one question" %}');
    } else {
        $('span.number_of_properties').html('{% trans "You answered" %} ' + number_of_properties + ' {% trans "questions" %}');
    }
    
    if ( number_of_properties === 0 && number_of_features !== 0 ) {    
        $( 'span.number_of_features' ).append('.');
    } else if ( number_of_properties !== 0 ) {    
        $( 'span.number_of_properties' ).append('.');
    }
}

jQuery(document).ready(function() {
    gnt.questionnaire.init('#forms', '', '#forms', questionnaire_area, data_group, show_feedback );
});


</script>
{% endblock javascript %}

