!function(){this.show_feedback=function(){var e,t,r,a,n,i,l,s,o,p,c,u,d,f,h,m,y,g,v,b,k,x,C,w,L,_,S,N,O,P;return f=function(){var e,t,r;return t=0,r={},e=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#9edae5","#98df8a","#aec7e8","#ffbb78","#ff9896","#c5b0d5","#c49c94","#f7b6d2","#c7c7c7","#dbdb8d"],function(a){return a in r||(r[a]=e[t++%20]),{strokeWidth:5,strokeColor:r[a],fillColor:"black",cursor:"pointer",fillOpacity:.1,pointRadius:6}}},d=function(){var e;return e=new OpenLayers.Control.SelectFeature(map.getControl("selectcontrol").layers.concat(map.getLayersByName("Marking Layer")[0]),{hover:!0,highlightOnly:!0,multiple:!0,renderIntent:"highlight",eventListeners:{featurehighlighted:k,featureunhighlighted:o}})},x=function(e){var t,r,a;if(e in C)return C[e];if(r=0,t=void 0,0===e.length)return r;for(a=0;a<e.length;)t=e.charCodeAt(a),r=(r<<5)-r+t,r&=r,a++;for(r=Math.abs(r);r in v;)r++;return v[r]=e,r=r.toString(),C[e]=r,r},t=function(e,t){return $("ul.feature-ctrl-main").css("list-style","none").append($("<li></li>").addClass("feature-level-ctrl").append($('<input type="checkbox">').addClass("feature-level-ctrl").attr("id",e).attr("value",e).prop("checked",!1).change(w)).append($("<label></label>").addClass("feedback-bold").css("color",t.style.strokeColor).text(e).attr("for",e)).append($("<ul></ul>").addClass("mini-questionnaire").css("list-style","none").css("padding","0").css("margin","0 0 0 10px").addClass(e).hide()))},e=function(e,t){return $("ul.property-ctrl-main").append($("<li></li>").html($("<div></div>").css("padding",0).addClass("feedback-bold").text(t)).append($("<ul></ul>").css("list-style","none").css("padding","0").css("margin","0 0 0 10px").addClass(e)))},w=function(e){var t,r,a,l,s,o,p,c,u,d,f;for(t=e.target.checked?"checked":"none",s=function(){var t,r,i,l;for(i=n[e.target.id],l=[],t=0,r=i.length;r>t;t++)a=i[t],l.push(P[a]);return l}(),o=0,u=s.length;u>o;o++)r=s[o],r.style.display=t;for(p=0,d=s.length;d>p;p++)r=s[p],O[r.attributes.user]===!1&&(r.style.display="none");for(c=0,f=s.length;f>c;c++)r=s[c],i[r.attributes.id]===!1&&(r.style.display="none");return l=$(e.target).closest("li.feature-level-ctrl").find(".mini-questionnaire"),"none"===t?l.hide():l.show(),map.getLayersByName("Marking Layer")[0].redraw()},_=function(e){var t,r,a,n,i,l,s;if(r={},0===e.length)return r;for(n=0,l=e.length;l>n;n++)for(t=e[n],i=0,s=t.length;s>i;i++)a=t[i],r[a]=!0;return r},c=function(e){var t,r,a,n,i,l,s,o,p,c,u,d;if(r={},0===e.length)return r;for(c=e[0],n=0,s=c.length;s>n;n++)a=c[n],r[a]=!0;if(1===e.length)return r;for(u=e[0],i=0,o=u.length;o>i;i++)for(a=u[i],d=e.slice(1),l=0,p=d.length;p>l;l++)if(t=d[l],-1===t.indexOf(a)){delete r[a];break}return r},l=function(e){var t,r,l,s,o,p;for(r=[],$(e.target).closest(".mini-questionnaire").find("input").each(function(){return this.checked?r.push(a[this.value]):void 0}),l=$('.feature-ctrl-andor input[value="and"]').first().prop("checked")?c(r):_(r),p=n[$(e.target).closest("li.feature-level-ctrl").find("input.feature-level-ctrl").attr("id")],s=0,o=p.length;o>s;s++)t=p[s],i[t]=t in l?!0:!1;return $(e.target).closest("li.feature-level-ctrl").find("input.feature-level-ctrl").change()},s=function(){var e,t,a,n,i,l,s;s=[],$("input.property-ctrl-boolean").each(function(){return this.checked?s.push(r[this.value]):void 0}),a=$('.property-ctrl-andor input[value="and"]').first().prop("checked")?c(s):_(s),n={},$("input.property-ctrl-min").each(function(){return n[this.name]=[parseInt(this.value)]}),$("input.property-ctrl-max").each(function(){return n[this.name].push(parseInt(this.value))});for(l in a)for(i in n)if(t=$("input#exclude-"+i).first().prop("checked"),l in S){if(!(i in S[l])){if(!t)continue;delete a[l]}e=S[l][i],e>=n[i][0]&&e<=n[i][1]||delete a[l]}else{if(!t)continue;delete a[l]}for(l in O)O[l]=l in a?!0:!1;return $("input.feature-level-ctrl").change()},y=function(t){var a,n,i,l,o,p,c,d,f,h,m,y,g,v,b,k;if(n=function(){var e,t,n,i,l,o,h,g;for(t=function(){return $("ul."+c).append($("<li></li>").append($("<label></label>").attr("for","min-"+c).append("Min:").append($("<input>").addClass("property-ctrl-min").attr("type","text").attr("id","min-"+c).css("max-width","50px").css("margin-left","5px").attr("name",c)).change(s))).append($("<li></li>").append($("<label></label>").attr("for","max-"+c).append("Max:").append($("<input>").addClass("property-ctrl-max").attr("type","text").css("max-width","50px").css("margin-left","5px").attr("id","max-"+c).attr("name",c)).change(s))).append($("<li></li>").append($("<label></label>").attr("for","exclude-"+c).append($("<input>").addClass("property-ctrl-exclude").attr("type","checkbox").attr("id","exclude-"+c).attr("name",c)).change(s).append("Exclude people who did not answer")))},e=function(){return $("ul."+c).append($("<li></li>").append($("<label></label>").attr("for",i).append($("<input>").addClass("property-ctrl-boolean").attr("type","checkbox").attr("id",i).val(i).attr("checked","checked")).change(s).append(n)))},g=[],l=0,o=a.length;o>l;l++)n=a[l],isNaN(Number(n))?(u(n)||(n="*long-answer"),i=x(c+"-AND-"+n),i in m||(e(),m[i]=!0),null==r[i]&&(r[i]=Array()),g.push(r[i].push(p.user))):(c in y||t(),n=parseInt(n),null==S[h=p.user]&&(S[h]={}),S[p.user][c]=n,null==d[c]&&(d[c]=n),n>d[c]&&(d[c]=n),null==f[c]&&(f[c]=n),n<f[c]?g.push(f[c]=n):g.push(void 0));return g},t.entry){for(o={user:!0,time:!0,id:!0,group:!0},y={},m={},d={},f={},k=t.entry,g=0,v=k.length;v>g;g++)if(p=k[g],!("form_values"in p)){null==N[b=p.user]&&(N[b]={});for(c in p)a=p[c],c in o||(h=c.split("t201")[0],c=x(h),c in y||e(c,h),a instanceof Array||(a=[a]),N[p.user][h]=a,n(),y[c]=!0)}for(c in d)i=d[c],$('input.property-ctrl-max[name="'+c+'"]').val(i);for(c in f)l=f[c],$('input.property-ctrl-min[name="'+c+'"]').val(l);return $("ul.property-ctrl-main ul").filter(function(){return $(this).find("li").length<2}).parent().remove(),$(".feedback-bold").css("font-weight","bold"),$("#property-ctrl").css("font-size","12px"),$("#property-ctrl input").css("height","12px"),$('#property-ctrl input[type="checkbox"]').css("vertical-align","sub").css("margin-right","3px"),$("#property-ctrl .loading").remove()}},m=function(e){var r,s,o,p,c,d,h,m,y,v,b,k,C,w;if(e.features){for(b=map.getLayersByName("Marking Layer")[0],m=f(),y=new OpenLayers.Format.GeoJSON,C=new OpenLayers.Projection(e.crs.properties.code),w=new OpenLayers.Projection(map.getProjection()),$("#feature-ctrl").append($("<ul></ul>").addClass("feature-ctrl-main").css("margin","0 0 0 10px").css("padding",0)),$("#feature-ctrl").prepend("<h2>Choose features to show</h2>"),$("#property-ctrl").prepend("<h2>Filter respondents</h2>"),k={},v=0;v<e.features.length;){h=y.parseFeature(e.features[v]),d=h.attributes.name,h.geometry.transform(C,w),h.lonlat=gnt.questionnaire.get_popup_lonlat(h.geometry),h.style=m(d),h.style.display="none",h.attributes.id=v,h=g(h),P[v]=h,O[h.attributes.user]=!0,d in n||(n[d]=Array(),t(d,h)),n[d].push(v);for(r in h.attributes.form_values){c=x([d,r].join("-AND-")),c in k||(k[c]=!0,$("."+d).append($("<li></li>").addClass("attr-ctrl").append($("<div></div>").css("color",h.style.strokeColor).html(r)).append($("<ul></ul>").css("list-style","none").css("margin","0 0 0 10px").css("padding",0).addClass(c))));for(o in h.attributes.form_values[r]){if(!u(o)){if(!isNaN(Number(o)))continue;o="*long-answer"}s=x([d,r,o].join("-AND-")),s in a||(a[s]=Array(),$("."+c).append($("<li></li>").append($('<input type="checkbox">').addClass("attribute-level-ctrl").attr("id",s).attr("value",s).attr("checked","checked").change(l)).append($("<label></label>").css("color",h.style.strokeColor).text(o).attr("for",s)))),a[s].push(v)}}b.addFeatures(h),v+=1}for(p in P)i[p]=!0;return $(".attr-ctrl").filter(function(){return $(this).find("li").length<2}).remove(),$(".feedback-bold").css("font-weight","bold"),$("#feature-ctrl").css("font-size","12px"),$("#feature-ctrl input").css("height","12px"),$('.feature-ctrl-andor input[value="or"]').prop("checked",!0),$(".feature-ctrl-andor input").change(L),$("#feature-ctrl .loading").remove(),$("input.feature-level-ctrl").first().prop("checked",!0).change()}},L=function(){return $("li.feature-level-ctrl").each(function(){return $(this).find("input.attribute-level-ctrl").first().change()})},u=function(e){return-1===e.indexOf(" ")&&e.charCodeAt(0)>="a".charCodeAt(0)&&e.charCodeAt(0)<="z".charCodeAt(0)?!0:!1},o=function(){return $("div.analysis_popup").hide()},k=function(e){var t,r,a,n,i,l,s,o,p,c,u;$(".analysis_popup").html("").hide(),$(".feature_comments").append('<div class="name">'+e.feature.attributes.name+"</div>"),a=e.feature.attributes.form_values;for(n in a){$(".feature_comments").append('<div class="attribute-name">'+n+"</div>"),l=$("<ul></ul>");for(o in a[n])l.append($("<li></li>").html(o));$(".feature_comments").append(l)}s=e.feature.attributes.user,$(".user_info").prepend($("<div>user: "+s+"</div>").addClass("username")),u=N[s];for(i in u){for(r=u[i],$(".user_info").append('<div class="attribute-name">'+i+"</div>"),l=$("<ul></ul>"),p=0,c=r.length;c>p;p++)t=r[p],l.append($("<li></li>").html(t));$(".user_info").append(l)}return $(".analysis_popup").show()},g=function(e){var t,r,a,n;for(a={},t=e.attributes.form_values,r=0;r<t.length;)n=t[r],n.name in a||(a[n.name]={}),a[n.name][n.value]=!0,r+=1;return e.attributes.form_values=a,e},O={},i={},n={},P={},a={},r={},S={},v={},C={},N={},$(".property-ctrl-andor input").change(s),$('.property-ctrl-andor input[value="or"]').first().prop("checked",!0),$(".span_right").css("left","570px"),$(".span_left").css("width","570px"),$("a#feedback").hide(),map.getLayersByName("Route Layer")[0].setVisibility(!1),map.getLayersByName("Point Layer")[0].setVisibility(!1),map.getLayersByName("Area Layer")[0].setVisibility(!1),h=new OpenLayers.Layer.Vector("Marking Layer",{styleMap:new OpenLayers.StyleMap({"default":{strokeWidth:3,strokeColor:"red",cursor:"pointer",fillColor:"#aaaaff",fillOpacity:.3,pointRadius:5},highlight:{strokeWidth:3,strokeColor:"#555555",cursor:"pointer",fillColor:"#555555",fillOpacity:.3,pointRadius:5}})}),map.addLayer(h),b=map.getControl("selectcontrol"),b.setLayer(b.layers.concat(h)),$("#property-ctrl").prepend('<div class="loading">Loading data... please wait</div>'),$("#feature-ctrl").prepend('<div class="loading">Loading data... please wait</div>'),gnt.geo.get_features("@all",data_group,"",{success:m}),gnt.geo.get_properties("@all",data_group,"@null","@all",{success:y}),p=d(),map.addControl(p),p.activate()},this.make_sld_getter=function(){var e,t,r,a;return t=0,r={},e=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],a='<?xml version="1.0" encoding="ISO-8859-1"?><StyledLayerDescriptor version="1.0.0" xsi:schemaLocation="http://www.opengis.net/sld StyledLayerDescriptor.xsd" xmlns="http://www.opengis.net/sld" xmlns:ogc="http://www.opengis.net/ogc" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"> <NamedLayer> <Name>NAME</Name> <UserStyle> <Title>SLD Cook Book: Line w2th border</Title> <FeatureTypeStyle> <Rule> <LineSymbolizer> <Stroke> <CssParameter name="stroke">#333333</CssParameter> <CssParameter name="stroke-width">7</CssParameter> <CssParameter name="stroke-linecap">round</CssParameter> </Stroke> </LineSymbolizer> </Rule> </FeatureTypeStyle> <FeatureTypeStyle> <Rule> <LineSymbolizer> <Stroke> <CssParameter name="stroke">COLOR</CssParameter> <CssParameter name="stroke-width">5</CssParameter> <CssParameter name="stroke-linecap">round</CssParameter> </Stroke> </LineSymbolizer> </Rule> </FeatureTypeStyle> </UserStyle> </NamedLayer></StyledLayerDescriptor>',function(n){var i,l;return i="",n in r?i=r[n]:(i=e[t++%10],r[n]=i),l=a.replace("NAME",n),l.replace("COLOR",i)}}}.call(this);
//# sourceMappingURL=../secret_js/feedback.js.map