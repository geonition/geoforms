function show_feedback(){function e(){var e=0,t={},r=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#9edae5","#98df8a","#aec7e8","#ffbb78","#ff9896","#c5b0d5","#c49c94","#f7b6d2","#c7c7c7","#dbdb8d"];return function(a){return a in t||(t[a]=r[e++%20]),{strokeWidth:5,strokeColor:t[a],fillColor:"black",cursor:"pointer",fillOpacity:.1,pointRadius:6}}}function t(){return hctrl=new OpenLayers.Control.SelectFeature(map.getControl("selectcontrol").layers.concat(map.getLayersByName("Marking Layer")[0]),{hover:!0,highlightOnly:!0,multiple:!0,renderIntent:"highlight",eventListeners:{featurehighlighted:o,featureunhighlighted:l}})}function r(e){var t=e.target.checked?"checked":"none";$("#"+e.target.id).closest("li").find("input").prop("checked",e.target.checked);for(var r,a=feature_name2id_list[e.target.id],i=0;i<a.length;i++)r=vizu_features[a[i]],r.style.display=t;map.getLayersByName("Marking Layer")[0].redraw()}function a(e){for(var t,r=e.target.checked?"true":"none",a=attribute2id_list[e.target.id],i=0;i<a.length;i++)t=vizu_features[a[i]],t.style.display=r;map.getLayersByName("Marking Layer")[0].redraw()}function n(e){if(e in u)return u[e];var t,r=0;if(0==e.length)return r;for(i=0;i<e.length;i++)t=e.charCodeAt(i),r=(r<<5)-r+t,r&=r;for(r=Math.abs(r);r in d;)r++;return d[r]=e,r=r.toString(),u[e]=r,r}function s(t){if(t.features){var i,s=map.getLayersByName("Marking Layer")[0],l=e(),o=new OpenLayers.Format.GeoJSON,d=new OpenLayers.Projection(t.crs.properties.code),u=new OpenLayers.Projection(map.getProjection());$(".loading").remove(),$("#analysis-ctrl").prepend($("<ul></ul>").addClass("analysis-ctrl-main")),$("#analysis-ctrl").prepend("<h2>Choose features to show</h2>");var p={};for(i=0;i<t.features.length;i+=1){var f=o.parseFeature(t.features[i]),m=f.attributes.name;f.geometry.transform(d,u),f.lonlat=gnt.questionnaire.get_popup_lonlat(f.geometry),f.style=l(m),f=c(f),vizu_features[i]=f,m in feature_name2id_list||(feature_name2id_list[m]=Array(),$("ul.analysis-ctrl-main").css("list-style","none").append($("<li></li>").append($('<input type="checkbox">').css("margin-right","5px").addClass("feature-level-ctrl").attr("id",m).attr("value",m).attr("checked","checked").change(r)).append($("<label></label>").css("color",f.style.strokeColor).text(m).attr("for",m)).append($("<ul></ul>").addClass(m))));for(var y in f.attributes.form_values){var h=n([m,y].join("-AND-"));h in p||(p[h]=!0,$("."+m).append($("<li></li>").addClass("attr-ctrl").append($("<div></div>").css("color",f.style.strokeColor).html(y)).append($("<ul></ul>").css("list-style","none").css("padding",0).addClass(h))));for(var g in f.attributes.form_values[y])if(-1==g.indexOf(" ")&&isNaN(Number(g))&&!(g.charCodeAt(0)>="A".charCodeAt(0)&&g.charCodeAt(0)<="Z".charCodeAt(0))){var v=n([m,y,g].join("-AND-"));v in attribute2id_list||(attribute2id_list[v]=Array(),$("."+h).append($("<li></li>").append($('<input type="checkbox">').css("margin-right","5px").addClass("attribute-level-ctrl").attr("id",v).attr("value",v).attr("checked","checked").change(a)).append($("<label></label>").css("color",f.style.strokeColor).text(g).attr("for",v)))),attribute2id_list[v].push(i)}}feature_name2id_list[m].push(i),s.addFeatures(f)}$(".attr-ctrl").filter(function(){return $(this).find("li").length<2}).remove()}}function l(){$("div.feature_comments").hide()}function o(e){$(".feature_comments").html("").hide(),$(".feature_comments").append('<div class="feature-name">'+e.feature.attributes.name+"</div>");var t=e.feature.attributes.form_values;for(var r in t){$(".feature_comments").append('<div class="feature-attribute-name">'+r+"</div>");var a=$("<ul></ul>");for(var i in t[r])a.append($("<li></li>").html(i));$(".feature_comments").append(a)}$(".feature_comments").show()}function c(e){var t={},r=e.attributes.form_values;for(i=0;i<r.length;i+=1){var a=r[i];a.name in t||(t[a.name]={}),t[a.name][a.value]=!0}return e.attributes.form_values=t,e}feature_name2id_list={},vizu_features={},attribute2id_list={};var d={},u={};map.getLayersByName("Route Layer")[0].setVisibility(!1),map.getLayersByName("Point Layer")[0].setVisibility(!1),map.getLayersByName("Area Layer")[0].setVisibility(!1);var p=new OpenLayers.Layer.Vector("Marking Layer",{styleMap:new OpenLayers.StyleMap({"default":{strokeWidth:3,strokeColor:"red",cursor:"pointer",fillColor:"#aaaaff",fillOpacity:.3,pointRadius:5},highlight:{strokeWidth:3,strokeColor:"#555555",cursor:"pointer",fillColor:"#555555",fillOpacity:.3,pointRadius:5}})});map.addLayer(p);var f=map.getControl("selectcontrol");f.setLayer(f.layers.concat(p)),$(".instructions").before($("<div></div>").attr("id","analysis-ctrl")).append('<h2 class="loading">Loading...</h2>'),gnt.geo.get_features("@all",data_group,"",{success:s});var m=t();map.addControl(m),m.activate()}function make_sld_getter(){var e=0,t={},r=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],a='<?xml version="1.0" encoding="ISO-8859-1"?><StyledLayerDescriptor version="1.0.0" xsi:schemaLocation="http://www.opengis.net/sld StyledLayerDescriptor.xsd" xmlns="http://www.opengis.net/sld" xmlns:ogc="http://www.opengis.net/ogc" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"> <NamedLayer> <Name>NAME</Name> <UserStyle> <Title>SLD Cook Book: Line w2th border</Title> <FeatureTypeStyle> <Rule> <LineSymbolizer> <Stroke> <CssParameter name="stroke">#333333</CssParameter> <CssParameter name="stroke-width">7</CssParameter> <CssParameter name="stroke-linecap">round</CssParameter> </Stroke> </LineSymbolizer> </Rule> </FeatureTypeStyle> <FeatureTypeStyle> <Rule> <LineSymbolizer> <Stroke> <CssParameter name="stroke">COLOR</CssParameter> <CssParameter name="stroke-width">5</CssParameter> <CssParameter name="stroke-linecap">round</CssParameter> </Stroke> </LineSymbolizer> </Rule> </FeatureTypeStyle> </UserStyle> </NamedLayer></StyledLayerDescriptor>';return function(i){var n="";i in t?n=t[i]:(n=r[e++%10],t[i]=n);var s=a.replace("NAME",i);return s.replace("COLOR",n)}}
//# sourceMappingURL=../secret_js/feedback.js.map